{% extends "base.html" %}

{% block content %}

<!-- –ù–∞–≤–∏–≥–∞—Ü–∏—è -->
<div class="card">
  <div class="nav-actions">
    <a href="/" class="btn">üè† –ù–∞ –≥–ª–∞–≤–Ω—É—é</a>
    <a href="/upload" class="btn btn-primary">üìÑ –ó–∞–≥—Ä—É–∑–∏—Ç—å –Ω–æ–≤—ã–π –¥–æ–≥–æ–≤–æ—Ä</a>
  </div>
</div>

<!-- –û–±–ª–æ–∂–∫–∞ –æ—Ç—á—ë—Ç–∞ -->
<div class="card">
  <div class="report-header">
    <div>
      <div class="report-title">–û–¢–ß–Å–¢ –ü–û –î–û–ì–û–í–û–†–£</div>
      <h1>{{ report.cover.contract_type | default('‚Äî', true) }}</h1>
      <div class="muted">
        –î–∞—Ç–∞ –∞–Ω–∞–ª–∏–∑–∞: {{ report.cover.analysis_date | default('‚Äî', true) }}
      </div>
    </div>

    <div class="report-status">
      <div class="status-badge">
        {{ report.cover.overall_status | default('‚Äî', true) }}
      </div>
      {% if not for_pdf %}
        <a href="/report/{{ job_id }}/pdf" class="btn-link">–°–∫–∞—á–∞—Ç—å PDF</a>
      {% endif %}
    </div>
  </div>

  <div class="report-meta">
    {% if report.cover.pages is defined and report.cover.pages %}
      <div><strong>–°—Ç—Ä–∞–Ω–∏—Ü:</strong> {{ report.cover.pages }}</div>
    {% endif %}
    {% if report.cover.chars is defined and report.cover.chars %}
      <div><strong>–°–∏–º–≤–æ–ª–æ–≤:</strong> {{ report.cover.chars }}</div>
    {% endif %}
  </div>
</div>

<!-- –†–µ–∑—é–º–µ -->
<div class="card">
  <h2>–†–µ–∑—é–º–µ</h2>
  {% set summary_list = report.summary | default([]) %}
  {% if summary_list and summary_list|length > 0 %}
    <ul>
      {% for item in summary_list %}
        <li>{{ item }}</li>
      {% endfor %}
    </ul>
  {% else %}
    <div class="muted">–†–µ–∑—é–º–µ –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç.</div>
  {% endif %}
</div>

<!-- –ö–∞—Ä—Ç–∞ —Ä–∏—Å–∫–æ–≤ -->
<div class="card">
  <h2>–ö–∞—Ä—Ç–∞ —Ä–∏—Å–∫–æ–≤</h2>

  {% set risk_list = report.risk_map | default([]) %}
  {% if risk_list and risk_list|length > 0 %}
    <div class="risk-grid">
      {% for item in risk_list %}
        <div class="risk-item">
          <div class="risk-category">{{ item.category | default('‚Äî', true) }}</div>
          <div class="risk-description">{{ item.description | default('', true) }}</div>
          {% if item.clause_ref is defined and item.clause_ref %}
            <div class="muted">–°—Å—ã–ª–∫–∞: {{ item.clause_ref }}</div>
          {% endif %}
        </div>
      {% endfor %}
    </div>
  {% else %}
    <div class="muted">–ù–µ—Ç –≤—ã–¥–µ–ª–µ–Ω–Ω—ã—Ö —Ä–∏—Å–∫–æ–≤.</div>
  {% endif %}
</div>

<!-- –ù–µ—Ç–∏–ø–∏—á–Ω—ã–µ —É—Å–ª–æ–≤–∏—è -->
<div class="card">
  <h2>–ù–µ—Ç–∏–ø–∏—á–Ω—ã–µ —É—Å–ª–æ–≤–∏—è</h2>

  {% set atypical_list = report.atypical | default([]) %}
  {% if atypical_list and atypical_list|length > 0 %}
    {% for item in atypical_list %}
      <div class="quote-block">
        {% if item.quote is defined and item.quote %}
          <div class="quote">‚Äú{{ item.quote }}‚Äù</div>
        {% endif %}
        <div>{{ item.note | default('', true) }}</div>
      </div>
    {% endfor %}
  {% else %}
    <div class="muted">–ù–µ—Ç –Ω–µ—Ç–∏–ø–∏—á–Ω—ã—Ö —É—Å–ª–æ–≤–∏–π.</div>
  {% endif %}
</div>

<!-- –ü—Ä–æ—Ç–∏–≤–æ—Ä–µ—á–∏—è -->
<div class="card">
  <h2>–ü—Ä–æ—Ç–∏–≤–æ—Ä–µ—á–∏—è</h2>

  {% set contradictions_list = report.contradictions | default([]) %}
  {% if contradictions_list and contradictions_list|length > 0 %}
    <ul>
      {% for item in contradictions_list %}
        <li>
          {{ item.description | default('', true) }}
          {% if item.clause_refs is defined and item.clause_refs %}
            ({{ item.clause_refs | join(", ") }})
          {% endif %}
        </li>
      {% endfor %}
    </ul>
  {% else %}
    <div class="muted">–ü—Ä–æ—Ç–∏–≤–æ—Ä–µ—á–∏—è –Ω–µ –æ–±–Ω–∞—Ä—É–∂–µ–Ω—ã.</div>
  {% endif %}
</div>

<!-- –ë–∞–ª–∞–Ω—Å –æ–±—è–∑–∞–Ω–Ω–æ—Å—Ç–µ–π -->
<div class="card">
  <h2>–ë–∞–ª–∞–Ω—Å –æ–±—è–∑–∞–Ω–Ω–æ—Å—Ç–µ–π</h2>

  {% set db = report.duties_balance | default({}) %}
  <div class="duties-grid">
    <div class="duties-col">
      <div class="duties-count">{{ db.customer_count | default(0, true) }}</div>
      <div class="duties-label">–æ–±—è–∑–∞–Ω–Ω–æ—Å—Ç–µ–π –∑–∞–∫–∞–∑—á–∏–∫–∞</div>
    </div>

    <div class="duties-col">
      <div class="duties-count">{{ db.provider_count | default(0, true) }}</div>
      <div class="duties-label">–æ–±—è–∑–∞–Ω–Ω–æ—Å—Ç–µ–π –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—è</div>
    </div>
  </div>

  {% if db.note is defined and db.note %}
    <div class="muted" style="margin-top: 10px;">{{ db.note }}</div>
  {% endif %}
</div>

<!-- –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ -->
<div class="card">
  <h2>–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏</h2>

  {% set recs = report.recommendations | default([]) %}
  {% if recs and recs|length > 0 %}
    <ul>
      {% for item in recs %}
        <li>{{ item }}</li>
      {% endfor %}
    </ul>
  {% else %}
    <div class="muted">–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç.</div>
  {% endif %}
</div>

<!-- –î–µ—Ç–∞–ª—å–Ω—ã–µ –∑–∞–º–µ—á–∞–Ω–∏—è -->
<div class="card">
  <h2>–î–µ—Ç–∞–ª—å–Ω—ã–µ –∑–∞–º–µ—á–∞–Ω–∏—è</h2>

  {% set findings = report.findings | default([]) %}
  {% if findings and findings|length > 0 %}
    {% for f in findings %}
      <div class="risk-item" style="margin-bottom:12px;">
        {% if f.title is defined and f.title %}
          <div class="risk-category">{{ f.title }}</div>
        {% endif %}
        <div class="risk-description">{{ f.text | default('', true) }}</div>

        {% if f.severity is defined and f.severity %}
          <div class="muted">–£—Ä–æ–≤–µ–Ω—å: {{ f.severity }}</div>
        {% endif %}

        {% if f.clause_ref is defined and f.clause_ref %}
          <div class="muted">–°—Å—ã–ª–∫–∞: {{ f.clause_ref }}</div>
        {% endif %}
      </div>
    {% endfor %}
  {% else %}
    <div class="muted">–î–µ—Ç–∞–ª—å–Ω—ã–µ –∑–∞–º–µ—á–∞–Ω–∏—è –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç.</div>
  {% endif %}
</div>

{% endblock %}

