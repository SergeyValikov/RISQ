{% extends "base.html" %}

{% block content %}
<section class="report">
  <div class="report-header">
    <div>
      <p class="eyebrow">Отчёт по договору</p>
      <h1>{{ report.cover.contract_type }}</h1>
      <p class="meta">Дата анализа: {{ report.cover.analysis_date }}</p>
    </div>
    <div class="status">
      <span>Страниц: {{ report.cover.pages }}</span>
      <strong>{{ report.cover.overall_status }}</strong>
    </div>
  </div>

  {% if not for_pdf %}
  <div class="actions">
    <a class="button primary" href="/report/{{ job_id }}/pdf">Скачать PDF</a>
  </div>
  {% endif %}

  <div class="section">
    <h2>Резюме</h2>
    <ul class="list">
      {% for item in report.summary %}
      <li>{{ item }}</li>
      {% endfor %}
    </ul>
  </div>

  <div class="section">
    <h2>Карта рисков</h2>
    {% if report.risk_map %}
    <div class="grid">
      {% for item in report.risk_map %}
      <div class="card-mini">
        <div class="tag">{{ item.category }}</div>
        <p>{{ item.description }}</p>
        <span class="meta">Ссылка: {{ item.clause_ref }}</span>
      </div>
      {% endfor %}
    </div>
    {% else %}
    <p class="muted">Нет выделенных рисков.</p>
    {% endif %}
  </div>

  <div class="section">
    <h2>Нетипичные условия</h2>
    {% if report.atypical %}
    <div class="stack">
      {% for item in report.atypical %}
      <div class="card-mini">
        <blockquote>“{{ item.quote }}”</blockquote>
        <p>{{ item.note }}</p>
      </div>
      {% endfor %}
    </div>
    {% else %}
    <p class="muted">Нет нетипичных условий.</p>
    {% endif %}
  </div>

  <div class="section">
    <h2>Противоречия</h2>
    {% if report.contradictions %}
    <ul class="list">
      {% for item in report.contradictions %}
      <li>{{ item.description }} <span class="meta">({{ item.clause_refs | join(", ") }})</span></li>
      {% endfor %}
    </ul>
    {% else %}
    <p class="muted">Противоречия не обнаружены.</p>
    {% endif %}
  </div>

  <div class="section">
    <h2>Баланс обязанностей</h2>
    <div class="balance">
      <div>
        <strong>{{ report.duties_balance.customer_count }}</strong>
        <span>обязанностей заказчика</span>
      </div>
      <div>
        <strong>{{ report.duties_balance.provider_count }}</strong>
        <span>обязанностей исполнителя</span>
      </div>
    </div>
    <p>{{ report.duties_balance.note }}</p>
  </div>

  <div class="section">
    <h2>Требует внимания специалиста</h2>
    {% if report.needs_specialist %}
    <ul class="list">
      {% for item in report.needs_specialist %}
      <li>{{ item.item }} <span class="meta">({{ item.clause_ref }})</span></li>
      {% endfor %}
    </ul>
    {% else %}
    <p class="muted">Нет пунктов, требующих дополнительной проверки.</p>
    {% endif %}
  </div>

  <div class="section">
    <h2>Отсутствующие разделы</h2>
    {% if report.missing_sections %}
    <div class="tags">
      {% for item in report.missing_sections %}
      <span class="tag">{{ item }}</span>
      {% endfor %}
    </div>
    {% else %}
    <p class="muted">Все ключевые разделы присутствуют.</p>
    {% endif %}
  </div>

  <div class="section disclaimer">
    <p>{{ report.disclaimer }}</p>
  </div>
</section>
{% endblock %}
